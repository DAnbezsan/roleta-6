<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Roleta Premiada Simples</title>
<style>
  body {
    margin: 0;
    padding: 20px;
    font-family: Arial, sans-serif;
    text-align: center;
    background: #fafafa;
  }
  h2 {
    margin-bottom: 10px;
  }
  #wheel {
    width: 90vw;
    max-width: 300px;
    display: block;
    margin: 10px auto 20px auto;
  }
  #spin {
    font-size: 18px;
    padding: 12px 24px;
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
  }
  input {
    padding: 10px;
    font-size: 16px;
    width: 80%;
    max-width: 260px;
    margin-bottom: 10px;
  }
</style>
</head>
<body>
<h2>Roleta Premiada</h2>
<input id="phoneInput" placeholder="Digite seu WhatsApp" />
<br />
<canvas id="wheel" width="300" height="300"></canvas>
<button id="spin">Girar</button>

<script>
// CONFIG
const ADMIN_PHONE = "5577998652620";
const prizes = ["10%", "15%", "20%", "25%", "30%", "Brinde" ];

// Normaliza telefone
function normalizePhone(p) {
  return p.replace(/\D/g,"").replace(/^55/,"");
}

// Carregar números que já giraram
let used = JSON.parse(localStorage.getItem("usedPhones") || "[]");

const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");
const spinBtn = document.getElementById("spin");
let angle = 0;

// Desenhar roleta
function drawWheel() {
  const arc = (2 * Math.PI) / prizes.length;
  for (let i = 0; i < prizes.length; i++) {
    ctx.beginPath();
    ctx.fillStyle = i % 2 === 0 ? "#ffcc00" : "#ff6666";
    ctx.moveTo(150, 150);
    ctx.arc(150, 150, 150, arc * i, arc * (i + 1));
    ctx.lineTo(150, 150);
    ctx.fill();

    ctx.save();
    ctx.translate(150, 150);
    ctx.rotate(arc * i + arc / 2);
    ctx.fillStyle = "#000";
    ctx.font = "bold 16px Arial";
    ctx.fillText(prizes[i], 50, 5);
    ctx.restore();
  }
}

drawWheel();

spinBtn.onclick = () => {
  const phone = normalizePhone(document.getElementById("phoneInput").value);

  if (!phone) return alert("Digite seu número");

  // Libera admin
  const isAdmin = phone === normalizePhone(ADMIN_PHONE);

  if (!isAdmin && used.includes(phone)) {
    return alert("Você já participou!");
  }

  // Sorteio
  const result = Math.floor(Math.random() * prizes.length);
  const arc = (2 * Math.PI) / prizes.length;
  const targetAngle = result * arc + arc / 2;
  angle = 10 * Math.PI + (2 * Math.PI - targetAngle);

  canvas.style.transition = "transform 4s ease-out";
  canvas.style.transform = `rotate(${angle}rad)`;

  setTimeout(() => {
    alert(`Você ganhou: ${prizes[result]}!`);
    if (!isAdmin) {
      used.push(phone);
      localStorage.setItem("usedPhones", JSON.stringify(used));
    }
  }, 4100);
};
</script>
</body>
</html>
