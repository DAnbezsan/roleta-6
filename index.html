<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Roleta Premiada</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<style>
  body {
    font-family: Arial, sans-serif;
    background: radial-gradient(circle at center, #111 0%, #000 100%);
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  h2 {
    margin-top: 20px;
    color: #FFD700;
    text-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
  }
  .wheel-container {
    position: relative;
    display: inline-block;
    margin-top: 20px;
    animation: pulse 2s infinite ease-in-out;
  }
  @keyframes pulse {
    0%, 100% { filter: brightness(1); }
    50% { filter: brightness(1.4); }
  }
  canvas {
    background: radial-gradient(circle, #fff 0%, #f1f1f1 100%);
    border-radius: 50%;
    box-shadow: 0 0 40px rgba(255, 215, 0, 0.6), inset 0 0 25px rgba(0,0,0,0.3);
  }
  /* luzes piscantes */
  .casino-lights {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 380px;
    height: 380px;
    border-radius: 50%;
    box-shadow: 0 0 25px rgba(255, 255, 255, 0.3);
    pointer-events: none;
  }
  .casino-lights::before, .casino-lights::after {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: 50%;
    border: 5px dashed rgba(255, 215, 0, 0.9);
    animation: spinLights 6s linear infinite;
  }
  .casino-lights::after {
    border-color: rgba(255, 0, 0, 0.9);
    animation-direction: reverse;
  }
  @keyframes spinLights {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }

  /* seta no topo apontando para baixo */
  .arrow {
    position: absolute;
    top: -25px;
    left: 50%;
    transform: translateX(-50%) rotate(180deg);
    width: 0;
    height: 0;
    border-left: 15px solid transparent;
    border-right: 15px solid transparent;
    border-top: 25px solid red;
    filter: drop-shadow(0 0 5px rgba(255,0,0,0.7));
  }

  #spinBtn {
    margin: 20px;
    padding: 12px 24px;
    font-size: 18px;
    border: none;
    border-radius: 8px;
    background: linear-gradient(90deg, #FFD700, #FF8C00);
    color: #000;
    cursor: pointer;
    font-weight: bold;
    text-shadow: 0 0 3px #fff;
    box-shadow: 0 0 15px rgba(255,215,0,0.6);
  }
  #spinBtn:hover {
    filter: brightness(1.2);
  }
  #spinBtn:disabled { background: #888; cursor: not-allowed; }
  .modal {
    display: none;
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.6);
    align-items: center;
    justify-content: center;
  }
  .modal-content {
    background: #fff;
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    width: 85%;
    max-width: 320px;
  }
  input {
    padding: 10px;
    width: 90%;
    margin-bottom: 10px;
    border: 1px solid #ccc;
    border-radius: 8px;
    font-size: 16px;
  }
  button {
    padding: 10px 18px;
    border: none;
    border-radius: 8px;
    background: #007bff;
    color: #fff;
    font-size: 16px;
    cursor: pointer;
    margin-top: 4px;
  }
  .close-btn { margin-top: 12px; background: #000; color: #fff; }
</style>
</head>
<body>
<h2>ðŸŽ° Roleta Premiada</h2>

<div class="wheel-container">
  <canvas id="wheel" width="320" height="320"></canvas>
  <div class="arrow"></div>
  <div class="casino-lights"></div>
</div>

<button id="spinBtn">Girar</button>

<div id="phoneModal" class="modal">
  <div class="modal-content">
    <h3>Digite seu telefone</h3>
    <input id="phoneInput" placeholder="DDD + nÃºmero" maxlength="13" />
    <button id="savePhoneBtn">Salvar</button>
  </div>
</div>

<div id="resultModal" class="modal">
  <div class="modal-content">
    <h2 id="resultTitle" style="margin:6px 0;font-size:20px;color:#000"></h2>
    <div id="qrcode" style="margin:10px auto;width:120px;height:120px;"></div>
    <button class="close-btn" id="closeRes">Fechar</button>
  </div>
</div>

<script>
const prizes = [
  {label:'DESIGN 50%', color:'#D4AF37'},
  {label:'FIO A FIO 50%', color:'#000000'},
  {label:'SHADOW L. 50%', color:'#D4AF37'},
  {label:'DESIGN 100%', color:'#000000'},
  {label:'FIO A FIO 100%', color:'#D4AF37'},
  {label:'SHADOW L. 100%', color:'#000000'}
];

const prizesSequence = [
  'DESIGN 50%','DESIGN 50%','DESIGN 50%','DESIGN 50%','DESIGN 50%',
  'FIO A FIO 50%','FIO A FIO 50%','FIO A FIO 50%',
  'DESIGN 50%','DESIGN 50%','DESIGN 50%','DESIGN 50%','DESIGN 50%',
  'SHADOW L. 50%','SHADOW L. 50%',
  'DESIGN 50%','DESIGN 50%','DESIGN 50%','DESIGN 50%','DESIGN 50%',
  'FIO A FIO 50%','FIO A FIO 50%','FIO A FIO 50%',
  'DESIGN 50%','DESIGN 50%','DESIGN 50%',
  'FIO A FIO 50%','FIO A FIO 50%',
  'SHADOW L. 100%',
  'DESIGN 100%','DESIGN 100%',
  'DESIGN 50%','DESIGN 50%',
  'SHADOW L. 50%','SHADOW L. 50%',
  'FIO A FIO 100%',
  'FIO A FIO 50%','FIO A FIO 50%',
  'DESIGN 100%','DESIGN 100%','DESIGN 100%',
  'SHADOW L. 50%',
  'DESIGN 100%','DESIGN 100%',
  'FIO A FIO 100%',
  'SHADOW L. 100%',
  'FIO A FIO 100%'
];

const canvas = document.getElementById('wheel');
const ctx = canvas.getContext('2d');
const cx = canvas.width / 2;
const cy = canvas.height / 2;
const r = Math.min(cx, cy) - 8;

function drawWheel(rotation = 0) {
  const arc = (2 * Math.PI) / prizes.length;
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.save();
  ctx.translate(cx, cy);
  ctx.rotate(rotation);

  for (let i = 0; i < prizes.length; i++) {
    const start = i * arc;
    const end = start + arc;

    const gradient = ctx.createRadialGradient(0, 0, r*0.3, 0, 0, r);
    if (prizes[i].color === '#D4AF37') {
      gradient.addColorStop(0, '#FFF8DC');
      gradient.addColorStop(0.5, '#FFD700');
      gradient.addColorStop(1, '#B8860B');
    } else {
      gradient.addColorStop(0, '#444');
      gradient.addColorStop(0.5, '#000');
      gradient.addColorStop(1, '#111');
    }

    ctx.beginPath();
    ctx.moveTo(0, 0);
    ctx.arc(0, 0, r, start, end);
    ctx.fillStyle = gradient;
    ctx.fill();
    ctx.lineWidth = 2;
    ctx.strokeStyle = "#fff";
    ctx.stroke();

    ctx.save();
    ctx.rotate(start + arc / 2);
    ctx.translate(r * 0.7, 0);
    ctx.rotate(-rotation - start - arc / 2);
    ctx.fillStyle = prizes[i].color === '#D4AF37' ? '#000' : '#FFD700';
    ctx.font = "bold 13px Arial";
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    ctx.fillText(prizes[i].label, 0, 0);
    ctx.restore();
  }

  ctx.beginPath();
  ctx.fillStyle = "red";
  ctx.arc(0, 0, 10, 0, 2 * Math.PI);
  ctx.fill();
  ctx.restore();
}
drawWheel();

let spinning = false;
let currentIndex = 0;
let usedPhones = JSON.parse(localStorage.getItem("usedPhones") || "[]");

document.getElementById('spinBtn').addEventListener('click', () => {
  if (spinning) return;
  document.getElementById('phoneModal').style.display = 'flex';
});

document.getElementById('savePhoneBtn').addEventListener('click', () => {
  const v = document.getElementById('phoneInput').value.trim();
  if (!/^\d{10,13}$/.test(v)) { alert('Digite um telefone vÃ¡lido com DDD'); return; }
  localStorage.setItem('wheelPhone', v);
  document.getElementById('phoneModal').style.display = 'none';
  startSpin(v);
});

function startSpin(phone) {
  if (spinning) return;
  if (phone !== "77998652620" && usedPhones.includes(phone)) {
    alert('Este nÃºmero jÃ¡ participou da promoÃ§Ã£o.');
    return;
  }

  spinning = true;
  const targetIndex = currentIndex % prizesSequence.length;
  const targetLabel = prizesSequence[targetIndex];
  const prizeIndex = prizes.findIndex(p => p.label === targetLabel);
  const spins = 5;
  const totalRotation = spins * 2 * Math.PI - (prizeIndex * (2 * Math.PI / prizes.length)) - (Math.PI / prizes.length);
  const start = performance.now();
  const duration = 4000;

  function animate(time) {
    const t = Math.min(1, (time - start) / duration);
    const ease = 1 - Math.pow(1 - t, 3);
    drawWheel(totalRotation * ease);
    if (t < 1) requestAnimationFrame(animate);
    else {
      spinning = false;
      currentIndex++;
      if (phone !== "77998652620") {
        usedPhones.push(phone);
        localStorage.setItem("usedPhones", JSON.stringify(usedPhones));
      }
      showResult(targetLabel, phone);
    }
  }
  requestAnimationFrame(animate);
}

function showResult(label, phone) {
  const modal = document.getElementById('resultModal');
  document.getElementById('resultTitle').textContent = label;
  modal.style.display = 'flex';
  document.getElementById('qrcode').innerHTML = '';
  new QRCode(document.getElementById("qrcode"), {
    text: window.location.href,
    width: 120,
    height: 120
  });

  fetch("https://script.google.com/macros/s/AKfycbxIjpHdsFx0TyHRs8YDe7fZlJ0l88SPQRklLu2QTMquIeHvvMuIr01ZRY-8GQi7yzXx/exec", {
    method: "POST",
    headers: { "Content-Type": "application/x-www-form-urlencoded" },
    body: `phone=${encodeURIComponent(phone)}&prize=${encodeURIComponent(label)}&date=${encodeURIComponent(new Date().toLocaleString())}`
  }).catch(err => console.error("Erro ao enviar:", err));

  const owner = "5577998633924";
  const msg = `ðŸŽ‰ OlÃ¡! Ganhei na Roleta Premiada!\nðŸ† PrÃªmio: ${label}\nðŸ“± Telefone: ${phone}`;
  setTimeout(() => { window.open(`https://wa.me/${owner}?text=${encodeURIComponent(msg)}`, "_blank"); }, 500);
}

document.getElementById('closeRes').addEventListener('click', () => {
  document.getElementById('resultModal').style.display = 'none';
});
</script>
</body>
</html>
